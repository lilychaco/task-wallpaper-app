<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚¿ã‚¹ã‚¯å£ç´™ãƒ¡ãƒ¼ã‚«ãƒ¼</title>

    <!-- PWAè¨­å®š -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#007aff">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="å£ç´™ãƒ¡ãƒ¼ã‚«ãƒ¼">
    <link rel="apple-touch-icon" href="icon-192.png">

    <!-- SEOãƒ»OGP -->
    <meta name="description" content="æ¯æ—¥ã®ã‚¿ã‚¹ã‚¯ã‚’ç¾ã—ã„å£ç´™ã«å¤‰æ›ã™ã‚‹Webã‚¢ãƒ—ãƒª">
    <meta name="keywords" content="å£ç´™,ã‚¿ã‚¹ã‚¯,TODO,ç”Ÿç”£æ€§,ã‚¢ãƒ—ãƒª">
    <meta property="og:title" content="ã‚¿ã‚¹ã‚¯å£ç´™ãƒ¡ãƒ¼ã‚«ãƒ¼">
    <meta property="og:description" content="æ¯æ—¥ã®ã‚¿ã‚¹ã‚¯ã‚’ç¾ã—ã„å£ç´™ã«å¤‰æ›">
    <meta property="og:type" content="website">
    <meta property="og:image" content="icon-512.png">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f7;
            min-height: 100vh;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        h1 {
            text-align: center;
            color: #1d1d1f;
            font-size: 2.5rem;
            margin-bottom: 30px;
        }

        .step {
            background: #f6f6f6;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #007aff;
        }

        .step h3 {
            margin-top: 0;
            color: #1d1d1f;
        }

        textarea {
            width: 100%;
            height: 200px;
            padding: 15px;
            border: 2px solid #d2d2d7;
            border-radius: 8px;
            font-size: 16px;
            font-family: inherit;
            resize: vertical;
        }

        .preview {
            width: 375px;
            height: 812px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 20px auto;
            border-radius: 25px;
            position: relative;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 80px 40px;
            text-align: center;
            color: white;
            font-size: 16px;
            line-height: 1.8;
            box-sizing: border-box;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }

        .preview-date {
            position: absolute;
            top: 80px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 14px;
            opacity: 0.9;
            width: 300px;
            text-align: center;
        }

        .preview-title {
            font-size: 26px;
            font-weight: bold;
            margin-bottom: 30px;
            max-width: 280px;
            word-wrap: break-word;
            overflow-wrap: break-word;
            hyphens: auto;
        }

        .preview-tasks {
            font-size: 16px;
            margin-bottom: 30px;
            max-width: 280px;
            word-wrap: break-word;
            overflow-wrap: break-word;
            text-align: left;
        }

        .preview-motto {
            position: absolute;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 14px;
            font-style: italic;
            opacity: 0.8;
            max-width: 280px;
            text-align: center;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }

        .buttons {
            text-align: center;
            margin-top: 30px;
        }

        button {
            background: #007aff;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin: 0 10px;
            transition: all 0.3s ease;
        }

        button:hover {
            background: #0056cc;
            transform: translateY(-2px);
        }

        .instruction {
            background: #e8f5e8;
            border: 1px solid #34c759;
            border-radius: 8px;
            padding: 20px;
            margin-top: 30px;
        }

        .instruction h3 {
            color: #30a46c;
            margin-top: 0;
        }

        .bg-selector {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin: 20px 0;
        }

        .bg-option {
            width: 60px;
            height: 60px;
            border-radius: 12px;
            cursor: pointer;
            border: 3px solid transparent;
            transition: all 0.3s ease;
        }

        .bg-option:hover {
            transform: scale(1.1);
        }

        .bg-option.active {
            border-color: #007aff;
            transform: scale(1.1);
        }

        .bg1 { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .bg2 { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
        .bg3 { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }
        .bg4 { background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); }
        .bg5 { background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“± ã‚·ãƒ³ãƒ—ãƒ«å£ç´™ãƒ¡ãƒ¼ã‚«ãƒ¼</h1>

        <div class="step">
            <h3>ã‚¹ãƒ†ãƒƒãƒ—1: ãƒ¡ãƒ¢å¸³ã®å†…å®¹ã‚’è²¼ã‚Šä»˜ã‘</h3>
            <textarea id="taskInput" placeholder="ãƒ¡ãƒ¢å¸³ã®å†…å®¹ã‚’ã“ã“ã«è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„..."></textarea>
        </div>

        <div class="step">
            <h3>ã‚¹ãƒ†ãƒƒãƒ—2: èƒŒæ™¯è‰²ã‚’é¸æŠ</h3>
            <div class="bg-selector">
                <div class="bg-option bg1 active" data-bg="bg1"></div>
                <div class="bg-option bg2" data-bg="bg2"></div>
                <div class="bg-option bg3" data-bg="bg3"></div>
                <div class="bg-option bg4" data-bg="bg4"></div>
                <div class="bg-option bg5" data-bg="bg5"></div>
            </div>
						
        </div>

        <div class="step">
            <h3>ã‚¹ãƒ†ãƒƒãƒ—3: ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç¢ºèª</h3>
            <div class="preview bg1" id="preview">
                <div class="preview-date" id="previewDate"></div>
                <div class="preview-title" id="previewTitle">ä»Šæ—¥ã®ã‚¿ã‚¹ã‚¯å®£è¨€</div>
                <div class="preview-tasks" id="previewTasks">ã‚¿ã‚¹ã‚¯ãŒè¡¨ç¤ºã•ã‚Œã¾ã™</div>
                <div class="preview-motto" id="previewMotto">ç¶™ç¶šã¯åŠ›ãªã‚Š</div>
            </div>
        </div>

        <div class="buttons">
            <button onclick="updatePreview()">ğŸ”„ ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼æ›´æ–°</button>
            <button onclick="downloadWallpaper()">ğŸ“± å£ç´™ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</button>
        </div>

        <div class="instruction">
            <h3>ğŸ¯ ä½¿ã„æ–¹ï¼ˆè¶…ç°¡å˜ï¼‰</h3>
            <ol>
                <li><strong>ãƒ¡ãƒ¢å¸³ã§Cmd+A â†’ Cmd+C</strong> (å…¨é¸æŠã—ã¦ã‚³ãƒ”ãƒ¼)</li>
                <li><strong>ä¸Šã®ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ã§Cmd+V</strong> (è²¼ã‚Šä»˜ã‘)</li>
                <li><strong>å¥½ããªèƒŒæ™¯è‰²ã‚’ã‚¯ãƒªãƒƒã‚¯</strong></li>
                <li><strong>ã€ŒğŸ”„ ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼æ›´æ–°ã€ã‚’ã‚¯ãƒªãƒƒã‚¯</strong></li>
                <li><strong>ã€ŒğŸ“± å£ç´™ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã€ã‚’ã‚¯ãƒªãƒƒã‚¯</strong></li>
                <li><strong>ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸç”»åƒã‚’ã‚¹ãƒãƒ›ã«é€ä¿¡ã—ã¦å£ç´™ã«è¨­å®š</strong></li>
            </ol>
        </div>
    </div>

    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <script>
        // æ—¥ä»˜æ›´æ–°
        function updateDate() {
            const now = new Date();
            const dateStr = now.toLocaleDateString('ja-JP', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                weekday: 'long'
            });
            document.getElementById('previewDate').textContent = dateStr;
        }

        // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼æ›´æ–°
        function updatePreview() {
            const text = document.getElementById('taskInput').value;
            const lines = text.split('\n').filter(line => line.trim() !== '');

            let title = '';
            let tasks = [];
            let motto = '';

            // ç°¡å˜ãªè§£æ
            for (let i = 0; i < lines.length; i++) {
                const line = lines[i].trim();

                if (line.includes('ã‚¿ã‚¹ã‚¯å®£è¨€') || line.includes('ç›®æ¨™')) {
                    title = line;
                } else if (line.includes('-') || line.includes('ãƒ»') || line.includes('â—‹')) {
                    tasks.push(line.replace(/^[-ãƒ»â—‹]\s*/, ''));
                } else if (i === lines.length - 1 || line.includes('ç¶™ç¶š') || line.includes('é ‘å¼µ') || line.includes('ã‚ˆã‚ã—ã')) {
                    motto = line;
                }
            }

            document.getElementById('previewTitle').textContent = title || 'ä»Šæ—¥ã®ã‚¿ã‚¹ã‚¯å®£è¨€';
            document.getElementById('previewTasks').innerHTML = tasks.slice(0, 6).join('<br>') || 'ã‚¿ã‚¹ã‚¯ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„';
            document.getElementById('previewMotto').textContent = motto || 'é ‘å¼µã‚Šã¾ã—ã‚‡ã†';
        }

        // èƒŒæ™¯å¤‰æ›´
        function changeBackground(bgClass) {
            const preview = document.getElementById('preview');
            preview.className = `preview ${bgClass}`;
        }

        // å£ç´™ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
        function downloadWallpaper() {
            alert('ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰é–¢æ•°ãŒå‘¼ã°ã‚Œã¾ã—ãŸ');
            
            // html2canvasãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
            if (typeof html2canvas === 'undefined') {
                alert('âŒ html2canvasãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“');
                return;
            }
            
            downloadWallpaperAsync();
        }
        
        async function downloadWallpaperAsync() {
            alert('éåŒæœŸé–¢æ•°é–‹å§‹');
            const preview = document.getElementById('preview');

            try {
                alert('html2canvasé–‹å§‹');
                const canvas = await html2canvas(preview, {
                    width: 375,
                    height: 812,
                    scale: 3,
                    backgroundColor: null,
                    logging: false,
                    useCORS: true
                });

                const dataURL = canvas.toDataURL('image/png');
                const today = new Date().toISOString().split('T')[0];
                
                // ãƒ¢ãƒ¼ãƒ€ãƒ«ã§ç”»åƒè¡¨ç¤º
                showImageModal(dataURL);
            } catch (error) {
                console.error('ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã‚¨ãƒ©ãƒ¼:', error);
                alert('âŒ ã‚¨ãƒ©ãƒ¼: ' + error.message);
            }
        }

        // ç”»åƒãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤º
        function showImageModal(dataURL) {
            console.log('showImageModal called');
            alert('ãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤ºé–‹å§‹');
            const modal = document.createElement('div');
            modal.id = 'imageModal';
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.9);
                display: flex;
                flex-direction: column;
                justify-content: center;
                align-items: center;
                z-index: 9999;
                padding: 20px;
                box-sizing: border-box;
            `;

            const img = document.createElement('img');
            img.src = dataURL;
            img.alt = 'å£ç´™';
            img.style.cssText = `
                max-width: 100%;
                max-height: 70%;
                border-radius: 20px;
                box-shadow: 0 4px 30px rgba(0,0,0,0.5);
            `;

            const instruction = document.createElement('div');
            instruction.style.cssText = `
                color: white;
                text-align: center;
                margin-top: 20px;
                padding: 20px;
                background: rgba(255,255,255,0.1);
                border-radius: 15px;
                backdrop-filter: blur(10px);
                font-size: 16px;
                line-height: 1.5;
            `;
            instruction.innerHTML = `
                <h3 style="margin-top: 0; color: #fff;">ğŸ“± ä¿å­˜æ–¹æ³•</h3>
                <p>ç”»åƒã‚’<strong>é•·æŠ¼ã—</strong>ã—ã¦</p>
                <p>ã€Œç”»åƒã‚’ä¿å­˜ã€ã‚’é¸æŠã—ã¦ãã ã•ã„</p>
            `;

            const closeBtn = document.createElement('button');
            closeBtn.textContent = 'âœ• é–‰ã˜ã‚‹';
            closeBtn.style.cssText = `
                position: absolute;
                top: 20px;
                right: 20px;
                background: rgba(255,255,255,0.2);
                color: white;
                border: none;
                padding: 10px 15px;
                border-radius: 20px;
                font-size: 16px;
                cursor: pointer;
                backdrop-filter: blur(10px);
            `;

            closeBtn.onclick = () => {
                document.body.removeChild(modal);
            };

            modal.onclick = (e) => {
                if (e.target === modal) {
                    document.body.removeChild(modal);
                }
            };

            modal.appendChild(closeBtn);
            modal.appendChild(img);
            modal.appendChild(instruction);
            document.body.appendChild(modal);
            console.log('Modal appended to body');
            
            setTimeout(() => {
                alert('âœ… ç”»åƒã‚’è¡¨ç¤ºã—ã¾ã—ãŸï¼\nç”»åƒã‚’é•·æŠ¼ã—ã—ã¦ã€Œç”»åƒã‚’ä¿å­˜ã€ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚');
            }, 100);
        }

        // PWA Service Workerç™»éŒ²
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('./sw.js')
                    .then(function(registration) {
                        console.log('SW registered: ', registration);
                    })
                    .catch(function(registrationError) {
                        console.log('SW registration failed: ', registrationError);
                    });
            });
        }

        // PWAã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            showInstallPromotion();
        });

        function showInstallPromotion() {
            const installBanner = document.createElement('div');
            installBanner.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                background: #007aff;
                color: white;
                padding: 15px;
                text-align: center;
                z-index: 9999;
                font-size: 14px;
            `;
            installBanner.innerHTML = `
                ğŸ“± ã‚¢ãƒ—ãƒªã¨ã—ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã§ãã¾ã™ï¼
                <button onclick="installPWA()" style="margin-left: 10px; padding: 5px 15px; background: white; color: #007aff; border: none; border-radius: 5px; cursor: pointer;">
                    ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
                </button>
                <button onclick="this.parentElement.remove()" style="margin-left: 5px; padding: 5px 10px; background: transparent; color: white; border: 1px solid white; border-radius: 5px; cursor: pointer;">
                    Ã—
                </button>
            `;
            document.body.insertBefore(installBanner, document.body.firstChild);
        }

        window.installPWA = async function() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                console.log(`User response to the install prompt: ${outcome}`);
                deferredPrompt = null;
            }
        };

        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', function() {
            updateDate();
            updatePreview();

            // èƒŒæ™¯é¸æŠ
            document.querySelectorAll('.bg-option').forEach(option => {
                option.addEventListener('click', function() {
                    document.querySelectorAll('.bg-option').forEach(opt => opt.classList.remove('active'));
                    this.classList.add('active');
                    changeBackground(this.dataset.bg);
                });
            });

            // ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°
            document.getElementById('taskInput').addEventListener('input', updatePreview);
        });
    </script>
</body>
</html>
